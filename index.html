<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>VerseCraft Early Access</title>
  <meta name="description" content="VerseCraft Early Access onboarding. Your Stories. Your Choices. Your RPG." />
  <style>
    :root{
      --bg:#070A12;
      --card:rgba(255,255,255,.06);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --line:rgba(255,255,255,.12);
      --accent:#8bd3ff;
      --warn:#ffb86b;
      --ok:#9dffb0;
      --danger:#ff6b6b;
      --radius:18px;
      --max:760px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; padding:18px;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:
        radial-gradient(1200px 700px at 50% 10%, rgba(139,211,255,.10), transparent 60%),
        radial-gradient(900px 600px at 70% 60%, rgba(255,184,107,.10), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:var(--max); margin:0 auto; padding-bottom:40px}
    .hero{
      padding:18px 16px; border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border-radius:var(--radius); position:relative; overflow:hidden;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .mark{
      width:44px; height:44px; border-radius:12px;
      background:
        radial-gradient(circle at 30% 30%, rgba(139,211,255,.9), rgba(139,211,255,.1) 60%),
        radial-gradient(circle at 70% 80%, rgba(255,184,107,.7), rgba(255,184,107,.05) 55%);
      border:1px solid rgba(255,255,255,.18);
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    h1{margin:0; font-size:22px; letter-spacing:.6px}
    .creed{margin-top:8px; color:var(--muted); font-weight:850; letter-spacing:.7px}
    .lead{margin-top:12px; line-height:1.5}
    .pillrow{margin-top:12px; display:flex; flex-wrap:wrap; gap:8px}
    .pill{
      padding:8px 10px; border:1px solid var(--line); border-radius:999px;
      color:var(--muted); background:rgba(0,0,0,.18); font-size:13px;
    }
    .card{
      margin-top:14px; padding:16px; border:1px solid var(--line);
      background:rgba(255,255,255,.05); border-radius:var(--radius);
    }
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .progress{
      flex:1; height:10px; border-radius:999px; overflow:hidden;
      background:rgba(255,255,255,.08); border:1px solid var(--line);
    }
    .progress>div{height:100%; width:0%; background:linear-gradient(90deg, rgba(139,211,255,.9), rgba(255,184,107,.9))}
    .step{color:var(--muted); font-size:13px; white-space:nowrap}
    .title{font-size:18px; margin:12px 0 6px}
    .desc{color:var(--muted); margin:0 0 12px; line-height:1.5}
    label{display:block; margin:10px 0 6px; color:var(--muted); font-size:13px}
    input[type="text"], input[type="email"], textarea{
      width:100%; padding:12px; border-radius:12px; border:1px solid var(--line);
      background:rgba(0,0,0,.25); color:var(--text); outline:none;
    }
    textarea{min-height:110px; resize:vertical}
    .grid{display:grid; gap:10px}
    .grid2{grid-template-columns:1fr 1fr}
    @media (max-width:640px){.grid2{grid-template-columns:1fr}}
    .choice{
      display:flex; gap:10px; align-items:flex-start;
      padding:12px; border-radius:14px; border:1px solid var(--line);
      background:rgba(0,0,0,.18); cursor:pointer; user-select:none;
    }
    .choice input{margin-top:2px}
    .choice b{display:block}
    .choice span{display:block; color:var(--muted); font-size:13px; margin-top:2px}
    .btnrow{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}
    button{
      border:1px solid var(--line); background:rgba(255,255,255,.07); color:var(--text);
      padding:12px 14px; border-radius:14px; font-weight:900; letter-spacing:.2px; cursor:pointer;
      flex:1;
    }
    button.primary{
      background:linear-gradient(90deg, rgba(139,211,255,.22), rgba(255,184,107,.20));
      border-color:rgba(255,255,255,.22);
    }
    button.danger{border-color:rgba(255,107,107,.35)}
    button:disabled{opacity:.55; cursor:not-allowed}
    .msg{
      margin-top:10px; padding:10px 12px; border-radius:14px; border:1px solid var(--line);
      background:rgba(0,0,0,.18); color:var(--muted);
    }
    .msg.ok{border-color:rgba(157,255,176,.35); color:rgba(157,255,176,.95)}
    .msg.warn{border-color:rgba(255,184,107,.35); color:rgba(255,184,107,.95)}
    .msg.bad{border-color:rgba(255,107,107,.35); color:rgba(255,107,107,.95)}
    .fineprint{margin-top:10px; font-size:12px; color:var(--muted); line-height:1.45}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .hide{display:none !important}
    iframe#submitFrame{width:0; height:0; border:0; position:absolute; left:-9999px; top:-9999px;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <div>
          <h1>VerseCraft Early Access</h1>
          <div class="creed">YOUR STORIES. YOUR CHOICES. YOUR RPG.</div>
        </div>
      </div>
      <p class="lead">Quick onboarding for early players and creators. Answer a few questions so we can prioritize stories, polish UI, and ship faster.</p>
      <div class="pillrow">
        <div class="pill">Code Blue</div>
        <div class="pill">World Of Lorecraft</div>
        <div class="pill">Wastelands</div>
      </div>
    </div>

    <div class="card">
      <div class="topbar">
        <div class="progress" aria-label="progress"><div id="bar"></div></div>
        <div class="step" id="stepLabel">Step 1 / 8</div>
      </div>

      <div id="screen"></div>

      <div class="btnrow">
        <button id="backBtn">Back</button>
        <button class="primary" id="nextBtn">Next</button>
        <button class="danger" id="resetBtn" title="Clear saved draft">Reset Draft</button>
      </div>

      <div id="msg" class="msg hide"></div>

      <div class="fineprint">
        By joining, you agree to be contacted about VerseCraft Early Access. We only use your email for access + updates.
      </div>
    </div>
  </div>

  <iframe id="submitFrame" name="submitFrame"></iframe>

  <!-- Hidden submit form (patched with your latest entry IDs; no placeholders) -->
  <form id="gform" method="POST" target="submitFrame" class="hide">
    <input type="hidden" name="entry.1769575433" id="f_email" />
    <input type="hidden" name="entry.320292224" id="f_consent" />
    <input type="hidden" name="entry.442312917" id="f_role" />
    <div id="genresHiddenMount"></div>
    <input type="hidden" name="entry.214422157" id="f_intensity" />
    <input type="hidden" name="entry.2097999812" id="f_session" />
    <input type="hidden" name="entry.758508774" id="f_device" />
    <input type="hidden" name="entry.344452528" id="f_story_first" />
    <input type="hidden" name="entry.540342776" id="f_source" />
    <input type="hidden" name="entry.1763248093" id="f_feedback" />
  </form>

  <script>
    const GOOGLE_FORM_ACTION_URL =
      "https://docs.google.com/forms/d/e/1FAIpQLSfFy61PYuFbLbt13ShNA6ujeYNYwLdC0khnqDXd0T_e-cKtIA/formResponse";

    const DRAFT_KEY = "versecraft_alpha_draft_v2";

    const state = loadDraft() || {
      email: "",
      consent: false,
      role: "",
      genres: [],
      intensity: "",
      session: "",
      device: "",
      story_first: "",
      feedback: "",
      createdAt: Date.now(),
      source: "GitHubPages"
    };

    let step = 0;

    const steps = [
      renderWelcome,
      renderEmailConsent,
      renderRole,
      renderTaste,
      renderDevice,
      renderStoryFirst,
      renderFreeform,
      renderSubmit
    ];

    const $ = (id) => document.getElementById(id);

    function showMsg(kind, text) {
      const el = $("msg");
      el.className = "msg " + (kind || "");
      el.textContent = text || "";
      el.classList.toggle("hide", !text);
    }

    function saveDraft() {
      try { localStorage.setItem(DRAFT_KEY, JSON.stringify(state)); } catch (_) {}
    }

    function loadDraft() {
      try {
        const raw = localStorage.getItem(DRAFT_KEY);
        return raw ? JSON.parse(raw) : null;
      } catch (_) { return null; }
    }

    function clearDraft() {
      try { localStorage.removeItem(DRAFT_KEY); } catch (_) {}
    }

    function setProgress() {
      const total = steps.length;
      const pct = Math.round((step / (total - 1)) * 100);
      $("bar").style.width = pct + "%";
      $("stepLabel").textContent = `Step ${Math.min(step + 1, total)} / ${total}`;
    }

    function mount(html) {
      $("screen").innerHTML = html;
      setProgress();
      saveDraft();
      wireStep();
      $("backBtn").disabled = step === 0;
      $("nextBtn").textContent = (step === steps.length - 1) ? "Done" : "Next";
    }

    function validEmail(s) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(s || "").trim());
    }

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function slug(s){
      return String(s || "").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");
    }

    function renderWelcome() {
      mount(`
        <div class="title">EARLY ACCESS: HELP BUILD THE PLATFORM</div>
        <p class="desc">
          Experience powerful interactive stories — then create worlds of your own.
          Your answers help us ship the right stories and polish the UX.
        </p>
        <div class="msg warn">
          Your progress saves on this device. You can come back later and finish.
        </div>
      `);
    }

    function renderEmailConsent() {
      mount(`
        <div class="title">Email</div>
        <p class="desc">We’ll use this to send Early Access details and updates.</p>

        <label>Email (required)</label>
        <input id="email" type="email" autocomplete="email" placeholder="you@example.com" value="${escapeHtml(state.email)}" />

        <label class="choice" for="consent" style="margin-top:12px">
          <input id="consent" type="checkbox" ${state.consent ? "checked" : ""} />
          <div>
            <b>I agree to be contacted</b>
            <span>Required to join Early Access.</span>
          </div>
        </label>
      `);
    }

    function radioCard(name, value, title, subtitle, current) {
      const checked = current === value ? "checked" : "";
      const id = `${name}_${slug(value)}`;
      return `
        <label class="choice" for="${id}">
          <input id="${id}" type="radio" name="${name}" value="${escapeHtml(value)}" ${checked} />
          <div>
            <b>${escapeHtml(title)}</b>
            <span>${escapeHtml(subtitle)}</span>
          </div>
        </label>
      `;
    }

    function checkCard(name, value, title, arr) {
      const checked = (arr || []).includes(value) ? "checked" : "";
      const id = `${name}_${slug(value)}`;
      return `
        <label class="choice" for="${id}">
          <input id="${id}" type="checkbox" name="${name}" value="${escapeHtml(value)}" ${checked} />
          <div><b>${escapeHtml(title)}</b></div>
        </label>
      `;
    }

    function radioSimple(name, value, title, current) {
      const checked = current === value ? "checked" : "";
      const id = `${name}_${slug(value)}`;
      return `
        <label class="choice" for="${id}">
          <input id="${id}" type="radio" name="${name}" value="${escapeHtml(value)}" ${checked} />
          <div><b>${escapeHtml(title)}</b></div>
        </label>
      `;
    }

    function renderRole() {
      const roles = [
        ["Reader/Player","I want intense stories and replayable endings."],
        ["Writer/Creator","I want to build worlds and branching stories."],
        ["QA/Bug Hunter","I enjoy breaking things and reporting issues."],
        ["RPG Systems Nerd","I care about items, flags, consequences, balance."],
        ["UI/UX Feedback","I notice friction and want it smoother."],
        ["I just want in","Put me where I’m useful."]
      ];
      mount(`
        <div class="title">Role</div>
        <p class="desc">Pick what best fits you — this helps us route you into the right feedback loops.</p>
        <div class="grid">
          ${roles.map(([v,sub]) => radioCard("role", v, v, sub, state.role)).join("")}
        </div>
      `);
    }

    function renderTaste() {
      const genreOptions = [
        "Fantasy","Action/Adventure","Western","Sci-Fi","Scientific Realism","Romance/Drama",
        "Horror","Survival","Spy/Thriller","Mythic/Cosmic","Medical Drama","Cozy"
      ];
      const intensityOptions = ["Cozy","Medium","Dark","Brutal Consequences"];
      const sessionOptions = ["5-10 minutes","10-20 minutes","20-40 minutes","Binge"];

      mount(`
        <div class="title">Taste Profile</div>
        <p class="desc">This helps us prioritize which stories and tones to ship first.</p>

        <label>Favorite genres (pick any)</label>
        <div class="grid grid2">
          ${genreOptions.map(g => checkCard("genres", g, g, state.genres)).join("")}
        </div>

        <label>Preferred intensity</label>
        <div class="grid grid2">
          ${intensityOptions.map(v => radioSimple("intensity", v, v, state.intensity)).join("")}
        </div>

        <label>Preferred session length</label>
        <div class="grid grid2">
          ${sessionOptions.map(v => radioSimple("session", v, v, state.session)).join("")}
        </div>
      `);
    }

    function renderDevice() {
      const deviceOptions = ["iOS Safari","Android Chrome","Desktop","Other"];
      mount(`
        <div class="title">Device</div>
        <p class="desc">This helps us optimize performance and UI.</p>

        <label>Primary device</label>
        <div class="grid grid2">
          ${deviceOptions.map(v => radioSimple("device", v, v, state.device)).join("")}
        </div>
      `);
    }

    function renderStoryFirst() {
      const storyOptions = [
        ["Code Blue","High-stakes medical decisions. No undo button."],
        ["World Of Lorecraft","Classic fantasy with consequence and replay."],
        ["Wastelands","Survival, scarcity, and hard choices."]
      ];
      mount(`
        <div class="title">Which Story First?</div>
        <p class="desc">This is how we decide what to spotlight in Early Access.</p>
        <div class="grid">
          ${storyOptions.map(([v,sub]) => radioCard("story_first", v, v, sub, state.story_first)).join("")}
        </div>
      `);
    }

    function renderFreeform() {
      mount(`
        <div class="title">Feedback</div>
        <p class="desc">One honest paragraph beats 100 shallow answers.</p>

        <label>What do you wish CYOA / RPG story apps did better?</label>
        <textarea id="feedback" placeholder="Consequences that carry over, earned endings, better UI, faster pacing, deeper branching...">${escapeHtml(state.feedback)}</textarea>
      `);
    }

    function renderSubmit() {
      const submittedAt = new Date().toISOString();
      mount(`
        <div class="title">Ready To Submit</div>
        <p class="desc">Submit your application. We’ll send Early Access details to your email.</p>

        <div class="msg">
          <b>Review</b><br/>
          Email: <span class="mono">${escapeHtml(state.email)}</span><br/>
          Role: <span class="mono">${escapeHtml(state.role || "(not set)")}</span><br/>
          Genres: <span class="mono">${escapeHtml((state.genres || []).join(", ") || "(none)")}</span><br/>
          Intensity: <span class="mono">${escapeHtml(state.intensity || "(not set)")}</span><br/>
          Session: <span class="mono">${escapeHtml(state.session || "(not set)")}</span><br/>
          Device: <span class="mono">${escapeHtml(state.device || "(not set)")}</span><br/>
          First story: <span class="mono">${escapeHtml(state.story_first || "(not set)")}</span><br/>
          Submitted At: <span class="mono">${escapeHtml(submittedAt)}</span><br/>
        </div>

        <div class="btnrow" style="margin-top:12px">
          <button class="primary" id="submitBtn">Submit Application</button>
        </div>
      `);

      state.submitted_at = submittedAt;
      saveDraft();

      document.getElementById("submitBtn").addEventListener("click", submitToGoogleForm);
    }

    function wireChoiceRadios(name, onChange) {
      document.querySelectorAll(`input[name="${name}"]`).forEach((el) => {
        el.addEventListener("change", () => onChange(el.value));
      });
    }

    function wireChoiceChecks(name, onChange) {
      document.querySelectorAll(`input[name="${name}"]`).forEach((el) => {
        el.addEventListener("change", () => {
          const values = Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(x => x.value);
          onChange(values);
        });
      });
    }

    function wireStep() {
      if (step === 1) {
        const email = $("email");
        const consent = $("consent");
        email.addEventListener("input", () => { state.email = email.value; saveDraft(); });
        consent.addEventListener("change", () => { state.consent = consent.checked; saveDraft(); });
      }
      if (step === 2) wireChoiceRadios("role", (v) => { state.role = v; saveDraft(); });
      if (step === 3) {
        wireChoiceChecks("genres", (vals) => { state.genres = vals; saveDraft(); });
        wireChoiceRadios("intensity", (v) => { state.intensity = v; saveDraft(); });
        wireChoiceRadios("session", (v) => { state.session = v; saveDraft(); });
      }
      if (step === 4) wireChoiceRadios("device", (v) => { state.device = v; saveDraft(); });
      if (step === 5) wireChoiceRadios("story_first", (v) => { state.story_first = v; saveDraft(); });
      if (step === 6) {
        const feedback = $("feedback");
        feedback.addEventListener("input", () => { state.feedback = feedback.value; saveDraft(); });
      }
    }

    function validateStep() {
      if (step === 0) return true;

      if (step === 1) {
        if (!validEmail(state.email)) { showMsg("bad", "Enter a valid email address."); return false; }
        if (!state.consent) { showMsg("bad", "Consent is required to join Early Access."); return false; }
      }

      if (step === 2 && !state.role) { showMsg("bad", "Pick a role so we can route you correctly."); return false; }

      if (step === 3) {
        if (!state.intensity) { showMsg("bad", "Pick an intensity level."); return false; }
        if (!state.session) { showMsg("bad", "Pick a session length."); return false; }
      }

      if (step === 4 && !state.device) { showMsg("bad", "Pick your primary device."); return false; }

      if (step === 5 && !state.story_first) { showMsg("bad", "Pick which story you want first."); return false; }

      if (step === 6) {
        const fb = String(state.feedback || "").trim();
        if (fb.length < 5) { showMsg("bad", "Give us at least a short sentence."); return false; }
      }

      return true;
    }

    function setHidden(id, value) {
      const el = document.getElementById(id);
      if (el) el.value = String(value ?? "");
    }

    function mountGenresHiddenInputs(genres) {
      const mount = document.getElementById("genresHiddenMount");
      mount.innerHTML = "";
      (genres || []).forEach((g) => {
        const inp = document.createElement("input");
        inp.type = "hidden";
        inp.name = "entry.312586037";
        inp.value = String(g || "");
        mount.appendChild(inp);
      });
    }

    function submitToGoogleForm() {
      showMsg("", "");
      if (!validateStep()) return;

      setHidden("f_email", String(state.email || "").trim().toLowerCase());
      setHidden("f_consent", state.consent ? "Yes" : "No");
      setHidden("f_role", state.role || "");
      mountGenresHiddenInputs(state.genres || []);
      setHidden("f_intensity", state.intensity || "");
      setHidden("f_session", state.session || "");
      setHidden("f_device", state.device || "");
      setHidden("f_story_first", state.story_first || "");
      setHidden("f_source", state.source || "GitHubPages");
      setHidden("f_feedback", String(state.feedback || "").trim());

      const form = document.getElementById("gform");
      form.action = GOOGLE_FORM_ACTION_URL;

      const btn = document.getElementById("submitBtn");
      if (btn) { btn.disabled = true; btn.textContent = "Submitting..."; }

      form.submit();

      setTimeout(() => {
        clearDraft();
        showMsg("ok", "Submitted. You’re in. Watch your inbox.");
        if (btn) btn.textContent = "Submitted";
      }, 900);
    }

    document.getElementById("nextBtn").addEventListener("click", () => {
      showMsg("", "");
      const ok = validateStep();
      if (!ok) return;
      if (step < steps.length - 1) { step++; steps[step](); }
    });

    document.getElementById("backBtn").addEventListener("click", () => {
      showMsg("", "");
      if (step > 0) { step--; steps[step](); }
    });

    document.getElementById("resetBtn").addEventListener("click", () => { clearDraft(); location.reload(); });

    steps[step]();
    setProgress();
  </script>
</body>
</html>
